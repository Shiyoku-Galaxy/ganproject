name: Daily → Notion
on:
  workflow_dispatch:

jobs:
  push:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Post to Notion
        env:
          NOTION_TOKEN: ${{ secrets.NOTION_TOKEN }}
          NOTION_VERSION: ${{ secrets.NOTION_VERSION }}
          DBID: ${{ secrets.NOTION_DATABASE_ID }}
        run: |
          set -euo pipefail
          DATE=$(date -u +%Y-%m-%d)
          TITLE="${DATE} Daily Log (GitHub)"

          # Notion JSON（プロパティ名はあなたのDBに合わせて日本語）
          read -r -d '' BODY <<'JSON'
          {
            "parent": { "database_id": "DBID" },
            "properties": {
              "Log Title": { "title": [ { "text": { "content": "TITLE" } } ] },
              "日付":       { "date":  { "start": "DATE" } },
              "Status":     { "status": { "name": "未着手" } },
              "Source":     { "select": { "name": "GitHub" } },
              "ProjectLink":{ "url": "https://github.com/Shiyoku-Galaxy/ganproject/actions" },
              "AutoSync":   { "checkbox": true }
            }
          }
          JSON

          # 置換
          BODY=${BODY/DBID/$DBID}
          BODY=${BODY/TITLE/$TITLE}
          BODY=${BODY/DATE/$DATE}

          # 送信
          curl -sS -X POST "https://api.notion.com/v1/pages" \
            -H "Authorization: Bearer ${NOTION_TOKEN}" \
            -H "Notion-Version: ${NOTION_VERSION}" \
            -H "Content-Type: application/json" \
            -d "${BODY}"
